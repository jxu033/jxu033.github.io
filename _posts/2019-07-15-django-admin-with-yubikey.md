---
title: "Yubikey One-time password for Django admin"
layout: post
date: 2019-07-15
tag:

- python
- django
- yubikey
- 2FA
 
image:
headerImage: false
projects: true
hidden: true # don't count this post in blog pagination
description: "Use yubikey otp as a second authentication for django admin"
jemoji: '<img class="emoji" title=":python:" alt=":python:" src="/assets/images/language_icon/python.png" height="20" width="20" align="absmiddle">'
author: Jiaqi Xu
externalLink: false
---

#### 1. Download Yubikey Personalization Tool
[Install guidance](https://www.yubico.com/products/services-software/personalization-tools/use/)
The YubiKey Personalization Tool is used to program the two configuration slots in your YubiKey.
Since I am using Ubuntu 16.04, I installed the tool based on [Enabling the Yubico PPA on Ubuntu](https://support.yubico.com/support/solutions/articles/15000010964-enabling-the-yubico-ppa-on-ubuntu).

Open the Yubikey Personalization tool we installed and insert the yubikey into USB, we will see the GUI like below:

![image](/assets/images/projects/yubikey_tool.png)

#### 2. Config Yubikey
Each YubiKey has two slots. The first slot is used to generate the passcode when the YubiKey button is touched for between 0.3 and 1.5 seconds and released. The second slot is used if the button is touched between 2 and 5 seconds. 

In this project, we only use and config Yubikey OTP mode and config the second slot of the yubikey we used.

1. Click `Yubikey OTP`, we will see two options: `Quick` and `Advanced`. `Quick` is for quickly program a Yubikey for use with Yubikey Validation Server. In our project, we use `Local Yubikey devices` as second factor and 
we notice the `Public Identity` is 4 bytes (for YubiCloud, it requires 6 bytes) when you create a local yubikey device in django admin. Additional, the public identify is the prefix for the otp generated by yubikey's corresponding slot.<br>
From all above, we need to use `Advanced` option so that we can config a slot with 4 bytes public identity.

2. Click `Advanced`, type the `Public Identity`(4 bytes), `Private Identity`, `Secret Key` that created from `local yubikey devices` in django admin into `Yubikey OTP Parameters` in `Advanced Panel`.

3. Click `Write Configuration` which will use the parameters we set to program the slot you choose.
After that, we will see `Yubikey has been successfully configured` in the top of current panel. The results is also shown in the `Results` part.

![image](/assets/images/projects/yubikey_otp_advanced.png)

4. Now, we all set. We can log into django admin site using your yubikey. 

|![image](/assets/images/projects/django_admin_yubikey.png)|![image](/assets/images/projects/loginwithyubikey.png)|

#### Github Link
[Django Admin with Yubikey as second Authentication](https://github.com/jiaqi-xu/Django-Admin-Yubikey)


#### Documentation I read
[Yubikey|Duo Security](https://duo.com/docs/yubikey)
[How to use a YubiKey for Two-Factor Secure Shell Authentication](https://www.linode.com/docs/security/authentication/how-to-use-yubikey-for-two-factor-ssh-authentication/)<br>
[Enabling the Yubico PPA on Ubuntu](https://support.yubico.com/support/solutions/articles/15000010964-enabling-the-yubico-ppa-on-ubuntu)<br>
[Yubikey Personalization Tool - User's Guide](https://www.yubico.com/wp-content/uploads/2016/03/YubiKeyPersonalizationToolUserGuideMarch2016.pdf)

